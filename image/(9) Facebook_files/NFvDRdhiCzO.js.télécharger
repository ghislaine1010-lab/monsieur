;/*FB_PKG_DELIM*/

__d("LSExpireNewFriendBump",["LSIssueNewTask","LSOptimisticRemoveThread"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=c.i64.or_(c.i64.cast([0,0]),c.i64.cast([256,0])),c.db.table(9).fetch([[[a[0]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,c.i64.eq(c.i64.and_(f.capabilities2,d[0]),d[0])&&c.i64.neq(f.mailboxType,c.i64.cast([0,4096]))?c.sequence([function(d){return c.storedProcedure(b("LSOptimisticRemoveThread"),a[0],c.i64.cast([0,1]))},function(e){return d[1]=new c.Map(),d[1].set("thread_key",a[0]),d[2]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTask"),"expire_new_friend_bump",c.i64.cast([0,416]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.resolve())})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxExpireNewFriendBumpStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSAutoExpireNewFriendBump",["LSExpireNewFriendBump"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=c.toJSON(d[0]),c.db.table(2).fetch([[[a[1]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,f.taskValue===d[1]?c.storedProcedure(b("LSExpireNewFriendBump"),a[0]):c.resolve())})},function(b){return c.forEach(c.db.table(2).fetch([[[a[1]]]]),function(a){return a["delete"]()})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxAutoExpireNewFriendBumpStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);